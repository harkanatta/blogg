---
title: GBIF og R
author: Valtýr
date: '2019-12-17'
slug: gbif-og-r
categories:
  - R
tags: []
description: Desc
hacker_news_id: ''
lobsters_id: ''
meta_img: /images/image.jpg
---
## Þetta skráir sig ekki sjálft

{{< gallery dir="/myndaalbum/" />}} {{< load-photoswipe >}}

```{r echo=FALSE}
#blogdown::shortcode("gallery", src = '"/myndaalbum/"', alt = "Some alt text", .content = "load-photoswipe")
blogdown::shortcode("figure", src = '"/myndaalbum/Efrimynd.png"', alt = "Some alt text")
```


Gögn eru dýrmæt ef þau eru aðgengileg. Opnir gagnagrunnar geta verið mjög mikilvægir fyrir rannsóknir ef þeir yfirgripsmiklir. Gagnagrunnurinn GBIF (stendur fyrir Global Biodiversity Information Facility). Það er gagnagrunnur þar sem skráð eru tilvik þar sem ýmsar lífverur hafa sést eða veiðst. Til þess að lífvera sé skráð í gagnagrunn þarf bæði hún og skrásetjarinn að vera til staðar. Þess vegna eru flest tilvik við þéttbýli eða fjölfarnar slóðir líkt og vegi og einnig, af sömu ástæðu, eru flest tilvik á fjölbýlli stöðum en á Íslandi. Auðvitað væri best ef að lífverurnar skráðu sig sjálfar í gagnagrunninn en svo gott er það ekki. Sem dæmi skal taka rostunga *Odobenus rosmarus* sem voru eitt sinn hluti af dýrafánu Íslands en ekki lengur því miður. Í þessu dæmi eru notaðir nokkrir R-pakkar. Til þess að kveikja á þeim öllum í einu er þetta góð aðferð:

`Packages <- c("rgbif", "leafpop" ,"mapview" ,"leaflet" ,"leaflet.extras" ,"magrittr" ,"sf" ,"rgdal")
lapply(Packages, library, character.only = TRUE)`

Pakkinn [rgbif](https://cran.r-project.org/web/packages/rgbif/index.html) gerir manni kleift að ná í gögn úr gagnagrunninum á einfaldan hátt: 

`Latneskt <- "Odobenus rosmarus"`
`tegund <- occ_search(scientificName = Latneskt, limit = 20) #limit = 20 má stroka út til að fá öll gögnin sem eru í boði`

Út úr þessu fær maður `list`a sem inniheldur nokkra lista á en það form er eitthvað það leiðinlegasta til að vinna með, að því er mér finnst. Einn hluti listans er `data.frame` (á forminu `tibble` frá `tidyverse`) sem er nefndur *data* en í honum eru GPS-hnit og aragrúi annarra upplýsinga. Munurinn á listum og data.frame er að hið síðarnefnda er hægt að sjá fyrir sér sem töflu (*Excel-skjal*) á meða listar eru eins og skjalaskápur. Þessi samlíking er samt mjög takmörkuð og þegark kemur að hraða úrvinnslu þá eru listar hraðari en *data frames*. Gott er að taka töfluna úr listanum til að vinna með:

`DF <- tegund$data`

Sumar skráningarnar skortir GPS-hnit og þar sem ég er að gera kort þá er best að taka þær skráningar alveg út úr gögnunum:

`DF <- DF[!is.na(DF[,3]) & !is.na(DF[,4]),]`



```{r rostungur, echo=FALSE, message=FALSE, warning=FALSE}
Packages <- c("rgbif","leafpop","mapview","leaflet","leaflet.extras","magrittr","sf","rgdal")
invisible(lapply(Packages, library, character.only = TRUE))

Latneskt <- "Turdus merula"
tegund <- occ_search(scientificName = Latneskt)
DF <- tegund$data
DF <- DF[!is.na(DF[,4]) & !is.na(DF[,3]),]
DF2 <- DF[,c(2,15,16,66,70)] # áhugaverðr dálkar hjá *Odobenus rosmarus* en ekkert endilega hjá öðrum tegundum
punktar<- SpatialPointsDataFrame(DF[,c(4,3)], DF[,-c(4,3)])
rgdal::writeOGR(obj=punktar, dsn='tegund.geojson', layer='DF', driver='GeoJSON', overwrite_layer = TRUE)


a <- list()
c <- list()
for (i in 1:492) {
  a[i] <- tegund$media[[i]]
  b <- a[i] %>% unlist() %>% as.data.frame()
  c[i] <- ifelse(dim(table(grepl("identifier",rownames(b))))<2,list(c(NA,NA)),list(c(as.character(b[rownames(b)=="key",]),as.character(b[rownames(b)=="identifier",]))))
}
DF3 <- do.call(rbind,c)
DF3 <- DF3[complete.cases(DF3),]

Tilvik <- sf::read_sf("tegund.geojson")
Tilvik$mynd <-  ifelse(Tilvik$key %in% DF3[,1],DF3[,2],NA)
Myndir <- Tilvik[!is.na(Tilvik$mynd),]

library(mapview)     
map <- mapview(Tilvik,col.regions="#cb5600",map.types="Esri.WorldImagery", legend = F,popup=leafpop::popupTable(DF2)) +
  mapview(Myndir,legend=FALSE,col.regions="blue",cex=14, popup = leafpop::popupImage(Myndir$mynd,width="300"))

img <- "data:image/png;base64,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"
library(magrittr)
map %>% leafem::addLogo(img, width = 60, height = 30,offset.y = 20,offset.x = 80,alpha = 0.4, url = "https://www.gbif.org/") %>% leaflet.extras::addFullscreenControl(pseudoFullscreen = T)
```


Margskonar upplýsingar geta verið skráðar um hvert tilvik. 